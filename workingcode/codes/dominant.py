import csv
import numpy as np
from numpy import shape
import operator
import sys

fname = sys.argv[1]
outpath=sys.argv[2]

with open(fname,'r') as f:
    csv_data = csv.reader(f,delimiter = ',')
    data = [data for data in csv_data]
    

np_data=np.asarray(data, dtype=np.chararray)

b=0
m=0

opdata=np.asarray(np_data[:,0:1808],dtype=np.float)
#print len(opdata[0])        
no_of_op=len(opdata[0])
sum_ben=np.zeros(no_of_op)
sum_mal=np.zeros(no_of_op)
diff=np.zeros((no_of_op,2))
for i in xrange(len(np_data)):
    if np_data[i][1808] == "b":
        b=b+1
        for j in xrange(no_of_op):
            sum_ben[j]=sum_ben[j]+opdata[i][j]
    else:
        m=m+1
        for j in xrange(no_of_op):
            sum_mal[j]=sum_mal[j]+opdata[i][j]
#'''
print b
print m
print sum_ben
print sum_mal
#'''
for i in xrange(no_of_op):
    sum_ben[i]=sum_ben[i]/b
    sum_mal[i]=sum_mal[i]/m
    diff[i][0]=i
    diff[i][1]=abs(sum_ben[i]-sum_mal[i])

'''   
print sum_ben
print sum_mal
print diff
'''

diff_sort=sorted(diff,key=operator.itemgetter(1),reverse=True)
#print diff_sort

op_data=np.asarray(opdata,dtype=np.chararray)

for i in (20,40,60,80,100,120,140,160,180,200):
    t=[int(diff_sort[j][0]) for j in xrange(i)]
    t=sorted(t)
    #print t
    a=np.column_stack((np_data[:,[1808]],opdata[:,t]))
    #print shape(a)
    fn=outpath+"_dom_"+str(i)+".csv"
    #colname="cluster_no,filename,size,src,class,no_of_op"
    colname="class"
    fmt1="%s"
    for j in t:
        colname+=",op"+str(j+1)
        fmt1+=",%.18f"
    np.savetxt(fn, a, fmt=fmt1, delimiter=',',header=colname,comments='')
